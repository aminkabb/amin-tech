<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amin Tech | Ù…Ù†ØµØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0f172a; color: #fff; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #ef4444; border-radius: 4px; }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s;
        }
        .glass-card:hover { transform: translateY(-5px); border-color: #ef4444; }

        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 ratio */
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .video-wrapper iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;
        }

        .playlist-item.active { background-color: rgba(239, 68, 68, 0.2); border-right: 4px solid #ef4444; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100">

    <div id="video-overlay" class="fixed inset-0 bg-black/95 z-50 hidden flex flex-col">
        <div class="p-4 border-b border-white/10 flex justify-between items-center bg-slate-900/90">
            <button onclick="closePlayer()" class="bg-slate-800 hover:bg-red-600 px-4 py-2 rounded text-sm font-bold transition">âœ– Ø¥ØºÙ„Ø§Ù‚</button>
            <span id="course-title-display" class="font-bold text-red-500">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©</span>
        </div>

        <div class="flex-1 flex flex-col lg:flex-row overflow-hidden">
            <div class="flex-1 p-4 lg:p-8 flex flex-col justify-center overflow-y-auto">
                <div class="video-wrapper w-full max-w-5xl mx-auto">
                    <iframe id="main-frame" src="" allow="autoplay; encrypted-media; fullscreen" allowfullscreen></iframe>
                </div>
                <div class="mt-4 max-w-5xl mx-auto">
                    <h2 id="video-title-display" class="text-2xl font-bold text-white mb-2">...</h2>
                    <p id="video-desc-display" class="text-slate-400 text-sm">...</p>
                </div>
            </div>

            <div class="w-full lg:w-96 bg-slate-800 border-r border-white/5 flex flex-col h-1/3 lg:h-full">
                <div class="p-3 bg-slate-900 font-bold text-center border-b border-white/5">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</div>
                <div id="playlist-items" class="flex-1 overflow-y-auto p-2 space-y-2"></div>
            </div>
        </div>
    </div>

    <nav class="sticky top-0 z-40 bg-slate-900/90 backdrop-blur border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 h-20 flex justify-between items-center">
            <h1 class="text-2xl font-black">Amin<span class="text-red-600">Tech</span></h1>
            <a href="#contact" class="bg-red-600 px-5 py-2 rounded-full font-bold text-sm hover:bg-red-700 transition">Ø§Ø·Ù„Ø¨ Ù…Ø´Ø±ÙˆØ¹Ùƒ</a>
        </div>
    </nav>

    <section class="py-20 px-4">
        <h2 class="text-3xl font-black text-center mb-10">Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
        <div id="loader" class="text-center py-10"><div class="animate-spin text-4xl">â³</div></div>
        <div id="courses-grid" class="grid md:grid-cols-3 gap-6 max-w-7xl mx-auto hidden"></div>
    </section>

    <section id="contact" class="py-20 bg-slate-800 px-4 text-center">
        <div class="max-w-2xl mx-auto">
            <h2 class="text-3xl font-black mb-6">Ø§Ø¨Ø¯Ø£ Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù…Ø¹Ù†Ø§</h2>
            <form id="hire-form" class="space-y-4">
                <input id="clientName" type="text" placeholder="Ø§Ù„Ø§Ø³Ù…" class="w-full p-3 rounded bg-slate-700 border-none text-white focus:ring-2 ring-red-500" required>
                <input id="clientPhone" type="tel" placeholder="Ø§Ù„Ù‡Ø§ØªÙ" class="w-full p-3 rounded bg-slate-700 border-none text-white focus:ring-2 ring-red-500" required>
                <textarea id="projectDetails" rows="4" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹" class="w-full p-3 rounded bg-slate-700 border-none text-white focus:ring-2 ring-red-500" required></textarea>
                <button type="submit" class="w-full bg-red-600 py-3 rounded font-bold hover:bg-red-700 transition">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ğŸš€</button>
            </form>
            <div id="form-msg" class="hidden mt-4 text-green-400 font-bold">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!</div>
        </div>
    </section>

    <footer class="py-8 text-center text-slate-500 text-sm border-t border-white/5">Â© 2025 Amin Tech</footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCI49mQ4v0xRO1RsbiAD23VLZEvzqZI3IE",
            authDomain: "myquizapp-f2686.firebaseapp.com",
            projectId: "myquizapp-f2686",
            storageBucket: "myquizapp-f2686.firebasestorage.app",
            messagingSenderId: "351586926960",
            appId: "1:351586926960:web:53182b527996af6fd9cfb5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let allVideos = [];

        signInAnonymously(auth).then(() => loadCourses()).catch(e => console.error("Auth Error:", e));

        // ---[ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø¬Ø²Ø© Ù„Ù„ÙØµÙ„ Ø¨ÙŠÙ† ÙŠÙˆØªÙŠÙˆØ¨ ÙˆØ¯Ø±Ø§ÙŠÙ ]---
        function getSmartUrl(url) {
            if (!url) return "";
            
            // 1. Ù„Ùˆ ÙŠÙˆØªÙŠÙˆØ¨ (Ø¨ÙƒÙ„ Ø£Ø´ÙƒØ§Ù„Ù‡)
            if (url.includes("youtu")) {
                const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                const match = url.match(regExp);
                const id = (match && match[2].length === 11) ? match[2] : null;
                // Ø¨Ù†Ø³ØªØ®Ø¯Ù… embed Ø¹Ø§Ø¯ÙŠ Ø¹Ø´Ø§Ù† ÙŠØ´ØªØºÙ„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
                return id ? `https://www.youtube.com/embed/${id}?autoplay=1&rel=0` : url;
            }
            
            // 2. Ù„Ùˆ Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ (Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ)
            if (url.includes("drive.google.com")) {
                // Ø¨Ù†Ø­ÙˆÙ„ Ø±Ø§Ø¨Ø· /view Ù„Ù€ /preview Ø¹Ø´Ø§Ù† ÙŠØ´ØªØºÙ„ embed
                return url.replace("/view", "/preview").replace("usp=sharing", "");
            }

            // 3. Ø£ÙŠ Ø±Ø§Ø¨Ø· ØªØ§Ù†ÙŠ Ø±Ø¬Ø¹Ù‡ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ
            return url;
        }

        window.openPlayer = async function(courseId, courseTitle) {
            document.getElementById('video-overlay').classList.remove('hidden');
            document.getElementById('course-title-display').innerText = courseTitle;
            const list = document.getElementById('playlist-items');
            list.innerHTML = '<div class="text-center p-4 text-slate-500">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

            try {
                let q = courseId ? query(collection(db, "videos"), where("courseId", "==", courseId)) : query(collection(db, "videos"));
                const snap = await getDocs(q);
                allVideos = [];
                snap.forEach(doc => allVideos.push(doc.data()));

                if (allVideos.length === 0) {
                    list.innerHTML = '<div class="text-center p-4">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</div>';
                } else {
                    list.innerHTML = allVideos.map((vid, idx) => `
                        <div onclick="playVideo(${idx})" class="playlist-item p-3 mb-2 bg-slate-700/50 rounded cursor-pointer hover:bg-slate-700 flex justify-between items-center">
                            <span class="text-sm font-bold text-slate-200">${vid.title}</span>
                            <span class="text-xs text-slate-400">${vid.duration || ''}</span>
                        </div>`).join('');
                    if(allVideos.length > 0) playVideo(0);
                }
            } catch(e) { console.error(e); }
        };

        window.playVideo = function(idx) {
            const vid = allVideos[idx];
            if(!vid) return;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
            document.getElementById('video-title-display').innerText = vid.title;
            document.getElementById('video-desc-display').innerText = vid.desc || '';

            // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù†Ø´Ø·
            document.querySelectorAll('.playlist-item').forEach((el, i) => {
                if(i === idx) el.classList.add('active'); else el.classList.remove('active');
            });

            // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø¬Ø²Ø©
            const iframe = document.getElementById('main-frame');
            iframe.src = getSmartUrl(vid.youtubeId);
        };

        window.closePlayer = function() {
            document.getElementById('video-overlay').classList.add('hidden');
            document.getElementById('main-frame').src = '';
        };

        async function loadCourses() {
            const grid = document.getElementById('courses-grid');
            const loader = document.getElementById('loader');
            try {
                const snap = await getDocs(query(collection(db, "courses")));
                let html = '';
                snap.forEach(doc => {
                    const data = doc.data();
                    html += `
                    <div class="glass-card rounded-xl overflow-hidden flex flex-col h-full">
                        <img src="${data.image}" class="w-full h-48 object-cover" onerror="this.src='https://via.placeholder.com/400'">
                        <div class="p-5 flex flex-col flex-1">
                            <h3 class="font-bold text-xl mb-2 text-white">${data.title}</h3>
                            <p class="text-slate-400 text-sm mb-4 flex-1">${data.desc || ''}</p>
                            <button onclick="openPlayer('${data.id}', '${data.title}')" class="w-full bg-slate-700 py-2 rounded font-bold hover:bg-red-600 transition">Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¢Ù†</button>
                        </div>
                    </div>`;
                });
                grid.innerHTML = html || '<p class="col-span-3 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
                loader.classList.add('hidden');
                grid.classList.remove('hidden');
            } catch(e) { console.error(e); }
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
        document.getElementById('hire-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            const msg = document.getElementById('form-msg');
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
            try {
                await addDoc(collection(db, "service_requests"), {
                    name: document.getElementById('clientName').value,
                    phone: document.getElementById('clientPhone').value,
                    details: document.getElementById('projectDetails').value,
                    timestamp: serverTimestamp()
                });
                msg.classList.remove('hidden');
                e.target.reset();
                setTimeout(() => msg.classList.add('hidden'), 3000);
            } catch(err) {} 
            finally { btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ğŸš€"; }
        });
    </script>
</body>
</html>
